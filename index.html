<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CampusDude</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  padding: 20px;
  color: #333;
}
h1 { color:#fff; text-align:center; }

.controls {
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:10px;
}

select {
  padding:8px 14px;
  border-radius:999px;
  border:none;
  font-weight:600;
}

/* TABLE */
table {
  width:100%;
  min-width:700px;
  background:#fff;
  border-collapse:collapse;
  margin-top:20px;
}
th,td {
  border:1px solid #ddd;
  padding:10px;
  text-align:center;
  vertical-align:top;
}
th { background:#1f2937; color:#fff; }

.lab { background:#bbf7d0; }
.class { background:#c7d2fe; }
.gap { background:#fecaca; }

.section { font-size:12px; font-weight:700; }
.room { font-size:12px; opacity:.8; }

.cell-countdown {
  display:inline-block;
  margin-top:6px;
  padding:2px 8px;
  background:#fff;
  border-radius:999px;
  font-size:12px;
}

/* ‚≠ê NEXT CLASS HIGHLIGHT */
.next {
  outline:3px solid #f59e0b;
  box-shadow:0 0 0 4px rgba(245,158,11,0.35);
}

.next-countdown {
  font-size:18px;
  font-weight:900;
  background:linear-gradient(135deg,#fde68a,#f59e0b);
  color:#7c2d12;
  padding:6px 14px;
  border-radius:999px;
  box-shadow:0 4px 12px rgba(245,158,11,0.5);
  animation:pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform:scale(1); }
  50% { transform:scale(1.05); }
  100% { transform:scale(1); }
}

/* TOP CARD */
#card {
  background:#fff7ed;
  padding:15px;
  border-left:6px solid #f59e0b;
  margin:20px auto;
  max-width:600px;
  display:none;
}
</style>
</head>

<body>

<h1>üéì CampusDude</h1>

<div class="controls">
  <label>üîî Notify</label>
  <select id="notifyBefore">
    <option value="5">5 min before</option>
    <option value="10">10 min before</option>
    <option value="15" selected>15 min before</option>
    <option value="30">30 min before</option>
  </select>
</div>

<div id="card">
  <strong>NEXT UPCOMING CLASS</strong>
  <div id="c-name"></div>
  <div id="c-meta"></div>
  <div id="c-time"></div>
</div>

<div style="overflow-x:auto">
<table id="table">
<tr>
  <th>Day</th>
  <th>08:00 ‚Äì 10:20</th>
  <th>10:20 ‚Äì 12:40</th>
  <th>12:40 ‚Äì 14:10</th>
  <th>14:40 ‚Äì 16:10</th>
</tr>

<tr>
  <th>Sunday</th>
  <td class="lab">Algorithms Laboratory<div class="section">[N]</div><div class="room">DS0103</div><div class="cell-countdown"></div></td>
  <td class="lab">Electronic Devices Laboratory<div class="section">[Q]</div><div class="room">DS0306</div><div class="cell-countdown"></div></td>
  <td class="gap">gap</td>
  <td class="class">Electronic Devices Theory<div class="section">[S]</div><div class="room">6116</div><div class="cell-countdown"></div></td>
</tr>

<tr>
  <th>Monday</th>
  <td class="class">Object Oriented Programming<div class="section">[M]</div><div class="room">9302</div><div class="cell-countdown"></div></td>
  <td class="gap">gap</td>
  <td class="gap">gap</td>
  <td class="class">Computational Statistics and Probability<div class="section">[BB]</div><div class="room">DN0610</div><div class="cell-countdown"></div></td>
</tr>

<tr>
  <th>Tuesday</th>
  <td class="class">Algorithms<div class="section">[N]</div><div class="room">9202</div><div class="cell-countdown"></div></td>
  <td class="lab">Physics Laboratory<div class="section">[S]</div><div class="room">DE0203</div><div class="cell-countdown"></div></td>
  <td class="gap">gap</td>
  <td class="class">Electronic Devices Theory<div class="section">[S]</div><div class="room">6116</div><div class="cell-countdown"></div></td>
</tr>

<tr>
  <th>Wednesday</th>
  <td class="lab">Object Oriented Programming Laboratory<div class="section">[M]</div><div class="room">DS0202</div><div class="cell-countdown"></div></td>
  <td class="gap">gap</td>
  <td class="gap">gap</td>
  <td class="class">Computational Statistics and Probability<div class="section">[BB]</div><div class="room">DN0610</div><div class="cell-countdown"></div></td>
</tr>
</table>
</div>

<script>
const TIME_SLOTS = [
  { start:"08:00", end:"10:20" },
  { start:"10:20", end:"12:40" },
  { start:"12:40", end:"14:10" },
  { start:"14:40", end:"16:10" }
];

const DAY_TO_INDEX = {
  Sunday:0, Monday:1, Tuesday:2, Wednesday:3,
  Thursday:4, Friday:5, Saturday:6
};

/* üîî Notifications */
if ("Notification" in window && location.protocol === "https:") {
  Notification.requestPermission();
}

const notifySelect = document.getElementById("notifyBefore");
let notifyBefore = Number(notifySelect.value);
const sent = new Set();

/* CORE LOOP */
function tick(){
  const now = new Date();
  let next = null, min = Infinity;

  document.querySelectorAll(".cell-countdown").forEach(c=>{
    c.textContent="";
    c.classList.remove("next-countdown");
  });
  document.querySelectorAll("td").forEach(td=>td.classList.remove("next"));

  document.querySelectorAll("#table tr").forEach((row,i)=>{
    if(i===0) return;

    const dayName = row.cells[0].innerText.trim();
    const dayIdx = DAY_TO_INDEX[dayName];

    [...row.cells].slice(1).forEach((cell,j)=>{
      if(cell.classList.contains("gap")) return;

      const target = new Date(now);
      let diffDay = dayIdx - now.getDay();
      if(diffDay < 0) diffDay += 7;
      target.setDate(now.getDate()+diffDay);

      const [h,m] = TIME_SLOTS[j].start.split(":");
      target.setHours(h,m,0,0);

      const diff = target - now;
      if(diff <= 0) return;

      const minsLeft = Math.floor(diff / 60000);
      const notifyKey = `${dayName}-${TIME_SLOTS[j].start}`;

      if (
        minsLeft === notifyBefore &&
        Notification.permission === "granted" &&
        !sent.has(notifyKey)
      ) {
        new Notification("üìö Upcoming Class", {
          body: `${cell.childNodes[0].nodeValue.trim()} starts in ${notifyBefore} minutes`
        });
        sent.add(notifyKey);
      }

      const d=Math.floor(diff/86400000);
      const hh=Math.floor(diff/3600000)%24;
      const mm=Math.floor(diff/60000)%60;
      const ss=Math.floor(diff/1000)%60;

      const countdown = `${d?d+"d ":""}${hh}h ${mm}m ${ss}s`;
      cell.querySelector(".cell-countdown").textContent = countdown;

      if(diff < min){
        min = diff;
        next = {
          name: cell.childNodes[0].nodeValue.trim(),
          section: cell.querySelector(".section")?.innerText || "",
          room: cell.querySelector(".room")?.innerText || "",
          meta: `${dayName} ‚Ä¢ ${TIME_SLOTS[j].start} ‚Äì ${TIME_SLOTS[j].end}`,
          countdown,
          cell
        };
      }
    });
  });

  if(next){
    next.cell.classList.add("next");
    const cd = next.cell.querySelector(".cell-countdown");
    cd.classList.add("next-countdown");

    document.getElementById("card").style.display="block";
    document.getElementById("c-name").textContent =
      `${next.name} ${next.section}`;
    document.getElementById("c-meta").textContent =
      `${next.meta} ‚Ä¢ ${next.room}`;
    document.getElementById("c-time").textContent = next.countdown;
  }
}

setInterval(tick,1000);
tick();
</script>

</body>
</html>
